<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="last modified" content="27/09/2021 12:47:24"><meta name=abstract content><meta name=author content="dpavel@vmware.com"><meta name=primary-product-name content="MD2Docs-TestBed"><meta name=primary-product-version content="1"><meta name=description content><meta name=guid content="GUID-1Intro"><meta name=language content="en"><meta name=title content="Basic Markdown"><meta name=publication-author content="dpavel@vmware.com"><meta property="og:title" content="Basic Markdown"><meta property="og:image" content="https://docs-uat.vmware.com/uicontent/images/vmware-docs-default.png"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:locale" content="en"><meta property="og:url" content="https://docs-uat-staging.vmware.com/en/MD2Docs-TestBed/1/md-2-docs-test-bed/GUID-1Intro.html"><meta name=cdf-utag content="https://tags.tiqcdn.com/utag/vmware/cdf-privacy/qa/utag.js"><link rel=stylesheet type=text/css href=/css/commonltr.css><link rel=stylesheet type=text/css href=/css/non-draft.vmware.productdocs.css><link rel=canonical href=https://docs-uat-staging.vmware.com/en/MD2Docs-TestBed/1/md-2-docs-test-bed/GUID-1Intro.html><link class=user href=/css/responsive.css rel=stylesheet type=text/css><link rel=icon href=https://www.vmware.com/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/v2-global.20200911172508.css><title>Docs Preview</title></head><body><header class=tech-pub-header><div id=header class="global-header col-12"><div class="row desktop-header h-100"><div class="col col-md-3 align-self-center header-logo-wrapper"><div class="d-inline-flex align-items-center justify-content-start w-100"><div class="d-inline-flex align-items-center w-100"><span class="my-auto d-md-none header-menu-icon"><i class="fa fa-bars"></i></span><h1><a href=https://docs-uat-staging.vmware.com/ class="d-inline-flex align-items-center my-auto nav-link header-logo-url pl-md-1 pl-xl-3"><span class=mr-2><img src=/img/vm-logo.png alt="VMware Logo"></span>
<span class=vm-logo-title>Docs Preview</span></a></h1></div><div class=align-items-center><span id=toggleTOC class="d-md-none header-toc-icon"><i class="fa fa-ellipsis-v px-2"></i></span></div></div></div></div></div><div class="col-12 vmware-gradient w-100 px-0 mx-0"></div></header><div class="tech-pub-container main-container d-flex flex-column pubView"><section class="tech-pub-section d-flex flex-md-row"><div class="lhs lhs-container col-md-4 col-lg-3" style=display:block><div class=backdrop></div><div class=left-panel><div class="panel-header position-relative hidden-xs"><div class="panel-header-left d-flex justify-content-between align-items-center"><span class=container-collapse-expand><span id=expand-all-id class=expand-tree onclick=expandAll()><span class="lhs-expand-shape align-middle"><i class="fa fa-chevron-down"></i></span>
<span class="expand-text align-middle" data-i18n data-i18n-expand-all>Expand All</span></span>
<span id=collapse-all-id class="collapse-tree hide" onclick=collapseAll()><span class="lhs-collapse-shape align-middle"><i class="fa fa-chevron-up"></i></span>
<span class="collapse-text align-middle" data-i18n data-i18n-collapse-all>Collapse All</span></span></span></div></div><div class="panel-content p-2" id=left_toc><div class="dropdown collection-dropdown-container w-100"><button class="btn w-100 text-left dropdown-toggle collection-name" type=button id=collectionDropdwnBtn data-toggle=dropdown aria-haspopup=true aria-label="Collection Dropdown" aria-expanded=false>
<span class=label></span>
<span class="float-right icon-down pl-2 fa fa-angle-down"></span></button><div class="dropdown-menu w-100" id=collectionMenu aria-labelledby=collectionDropdwnBtn></div></div><div id=tree class=mt-2></div><div class="w-100 px-2 toc-product-container"><a class="mr-3 my-2 position-relative toc-product-link"><span class=toc-product-name></span>
<span class=localized-page-name>Product Documentation</span></a></div><ul class=rm-default-ul-styles></ul></div></div></div><div class="rhs rhs-container col-md-8 col-lg-7" style=display:block><div class=rhs-top><div class="rhs-top-container-top d-flex flex-row justify-content-between"><div class=primary-header id=page-heading-id></div></div><div class="rhs-top-container-middle d-flex flex-row justify-content-between"></div><div class=rhs-top-container-bottom><div class=last-updated-container><div class=calendar-icon><svg width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path class="clr-i-outline clr-i-outline-path-1" d="M32.25 6H29V8h3V30H4V8H7V6H3.75A1.78 1.78.0 002 7.81V30.19A1.78 1.78.0 003.75 32h28.5A1.78 1.78.0 0034 30.19V7.81A1.78 1.78.0 0032.25 6z"/><rect class="clr-i-outline clr-i-outline-path-2" x="8" y="14" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-3" x="14" y="14" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-4" x="20" y="14" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-5" x="26" y="14" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-6" x="8" y="19" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-7" x="14" y="19" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-8" x="20" y="19" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-9" x="26" y="19" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-10" x="8" y="24" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-11" x="14" y="24" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-12" x="20" y="24" width="2" height="2"/><rect class="clr-i-outline clr-i-outline-path-13" x="26" y="24" width="2" height="2"/><path class="clr-i-outline clr-i-outline-path-14" d="M10 10a1 1 0 001-1V3A1 1 0 009 3V9a1 1 0 001 1z"/><path class="clr-i-outline clr-i-outline-path-15" d="M26 10a1 1 0 001-1V3a1 1 0 00-2 0V9a1 1 0 001 1z"/><rect class="clr-i-outline clr-i-outline-path-16" x="13" y="6" width="10" height="2"/><rect x="0" y="0" width="36" height="36" fill-opacity="0"/></svg></div><span class=last-updated-label data-i18n-updated-on>Updated on</span>
&nbsp;
<span class=last-updated-date-ph>9/22/22</span></div></div></div><div class="rhs-center article-wrapper" id=content-div-id><h1 id=tanzu-application-platform-deployment>Tanzu Application Platform Deployment</h1><p>This deployment outlines the deployment steps for VMware Tanzu Application Platform 1.1 on a Kubernetes workload cluster. In accordance with the <a href=../reference-designs/tap-architecture-planning.md>Tanzu Application Platform Reference Design</a>, four clusters will be created:</p><ul><li>Tanzu Application Platform Build Cluster</li><li>Tanzu Application Platform Run Cluster</li><li>Tanzu Application Platform View Cluster</li><li>Tanzu Application Platform Iterate Cluster</li></ul><h2 id=prerequisites>Prerequisites</h2><p>Before deploying VMware Tanzu Application Platform, ensure that the following prerequisites are met:</p><ul><li>A <a href=https://network.tanzu.vmware.com/>Tanzu Network</a> account is available for downloading Tanzu Application Platform packages.</li><li>A container image registry with push and write access (such as Harbor, Docker Hub, or Azure Container Registry) is available. This will be used for application images and runtime dependencies.</li><li>Network access to <a href=https://registry.tanzu.vmware.com>VMware&rsquo;s image registry</a> is available.</li></ul><ul><li>DNS Records for components like Cloud Native Runtimes (knative) i.e. cnrs, Tanzu Learning Center, Tanzu Application Platform GUI etc.</li><li>A centralized git repository from GitHub, Gitlab or Azure DevOps for the Tanzu Application Platform GUI&rsquo;s software catalogs, along with a token allowing read access.</li><li>A Kubernetes workload cluster versions 1.20, 1.21, or 1.22 on Azure Kubernetes Service, Amazon Elastic Kubernetes Service, Google Kubernetes Engine, or <a href=https://minikube.sigs.k8s.io/docs/start/>minikube</a> providers.</li></ul><ul><li>Accept the End User License Agreements (EULAs).</li><li>The Kubernetes CLI, kubectl, v1.20, v1.21 or v1.22, installed and authenticated with administrator rights for your target cluster.</li></ul><p>Additional details concerning prerequisites may be found in Tanzu Application Platform <a href=https://docs.vmware.com/en/Tanzu-Application-Platform/1.1/tap/GUID-prerequisites.html>documentation</a>.</p><p><em>Note:</em> Use the Kubernetes defaults <code>serviceDomain</code> of <code>cluster.local</code> in workload clusters where Tanzu Application Platform is deployed.</p><h2 id=overview-of-the-deployment-steps>Overview of the Deployment Steps</h2><p>The following provides an overview of the steps necessary to deploy Tanzu Application Platform. Each step links to a detailed information section.</p><ol><li><a href=#tap-build>Set Up Tanzu Application Platform Build cluster</a></li><li><a href=#tap-run>Set Up Tanzu Application Platform Run cluster</a></li><li><a href=#tap-ui>Set Up Tanzu Application Platform View cluster</a></li><li><a href=#tap-full>Set Up Tanzu Application Platform Iterate cluster</a></li><li><a href=#tap-sample-app>Deploy Sample Application</a></li></ol><h2 id=a-idtap-build-aset-up-tanzu-application-platform-build-cluster>Set Up Tanzu Application Platform Build Cluster</h2><p>The Build Cluster is responsible for taking a developer&rsquo;s source code commits and applying a supply chain that will produce a container image and Kubernetes manifests for deploying on a Run Cluster</p><h3 id=a-idtanzu-essential-a-step-1-install-tanzu-cluster-essentials-and-tanzu-cli>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</h3><p>Provide following user inputs into commands and execute them to install Tanzu Cluster Essentials and Tanzu CLI on your bootstrap/jumpbox machine.</p><ul><li><code>TAP_TAP_WORKLOAD_CONTEXT</code> - the <code>kubeconfig</code> context of the workload cluster</li><li><code>TANZU_NET_API_TOKEN</code> - an API token obtained from <a href=https://network.tanzu.vmware.com>https://network.tanzu.vmware.com</a></li><li><code>INSTALL_REGISTRY_USERNAME</code> - the Tanzu username</li><li><code>INSTALL_REGISTRY_PASSWORD</code> - the Tanzu user&rsquo;s password</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export TAP_WORKLOAD_CONTEXT<span style=color:#f92672>=</span>&lt;workload cluster context&gt;
</span></span><span style=display:flex><span>export TANZU_NET_API_TOKEN<span style=color:#f92672>=</span>&lt;tanzu refresh token&gt;
</span></span><span style=display:flex><span>export INSTALL_REGISTRY_HOSTNAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;registry.tanzu.vmware.com&#34;</span>
</span></span><span style=display:flex><span>export INSTALL_REGISTRY_USERNAME<span style=color:#f92672>=</span>&lt;tanzu username&gt;
</span></span><span style=display:flex><span>export INSTALL_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;tanzu password&gt;
</span></span><span style=display:flex><span>export INSTALL_BUNDLE<span style=color:#f92672>=</span>registry.tanzu.vmware.com/tanzu-cluster-essentials/cluster-essentials-bundle@sha256:ab0a3539da241a6ea59c75c0743e9058511d7c56312ea3906178ec0f3491f51d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># login to kubernetes workload cluster using cluster config</span>
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_WORKLOAD_CONTEXT<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export token<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -X POST https://network.pivotal.io/api/v2/authentication/access_tokens -d <span style=color:#e6db74>&#39;{&#34;refresh_token&#34;:&#34;&#39;</span><span style=color:#e6db74>${</span>TANZU_NET_API_TOKEN<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>access_token<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>${</span>token<span style=color:#e6db74>}</span> | jq -r .access_token<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -i -H <span style=color:#e6db74>&#34;Accept: application/json&#34;</span> -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> -H <span style=color:#e6db74>&#34;Authorization: Bearer </span><span style=color:#e6db74>${</span>access_token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -X GET https://network.pivotal.io/api/v2/authentication
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install tanzu cluster essentials(linux)</span>
</span></span><span style=display:flex><span>mkdir $HOME/tanzu-cluster-essentials
</span></span><span style=display:flex><span>wget https://network.tanzu.vmware.com/api/v2/products/tanzu-cluster-essentials/releases/1077299/product_files/1191987/download --header<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Authorization: Bearer </span><span style=color:#e6db74>${</span>access_token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -O $HOME/tanzu-cluster-essentials/tanzu-cluster-essentials-linux-amd64-1.1.0.tgz
</span></span><span style=display:flex><span>tar -xvf $HOME/tanzu-cluster-essentials/tanzu-cluster-essentials-linux-amd64-1.1.0.tgz -C $HOME/tanzu-cluster-essentials
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd $HOME/tanzu-cluster-essentials
</span></span><span style=display:flex><span>./install.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo cp $HOME/tanzu-cluster-essentials/kapp /usr/local/bin/kapp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd $HOME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install tanzu cli v(0.11.2) and plug-ins (linux)</span>
</span></span><span style=display:flex><span>mkdir $HOME/tanzu
</span></span><span style=display:flex><span>cd $HOME/tanzu
</span></span><span style=display:flex><span>wget https://network.pivotal.io/api/v2/products/tanzu-application-platform/releases/1078790/product_files/1190781/download --header<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Authorization: Bearer </span><span style=color:#e6db74>${</span>access_token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -O $HOME/tanzu/tanzu-framework-linux-amd64.tar
</span></span><span style=display:flex><span>tar -xvf $HOME/tanzu/tanzu-framework-linux-amd64.tar -C $HOME/tanzu
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo install cli/core/v0.11.2/tanzu-core-linux_amd64 /usr/local/bin/tanzu
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># tanzu plug-ins</span>
</span></span><span style=display:flex><span>export TANZU_CLI_NO_INIT<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>tanzu plugin install --local cli all
</span></span><span style=display:flex><span>tanzu plugin list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd $HOME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install yq package</span>
</span></span><span style=display:flex><span>sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
</span></span><span style=display:flex><span>sudo chmod a+x /usr/local/bin/yq
</span></span><span style=display:flex><span>yq --version
</span></span></code></pre></div><h3 id=a-idtap-package-repo-astep-2-add-the-tanzu-application-platform-package-repository>Step 2: Add the Tanzu Application Platform Package Repository</h3><p>To install kapp-controller on workload clusters that are deployed on vSphere with Tanzu (TKGS) using YAML files and Tanzu Kubernetes Grid API, see <a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.4/vmware-tanzu-kubernetes-grid-14/GUID-packages-prep-tkgs-kapp.html>Prepare a Tanzu Kubernetes Cluster Created by Using vSphere with Tanzu to Run Packages</a>.</p><p>After installing <code>kapp-controller</code>, install <a href=https://github.com/vmware-tanzu/carvel-secretgen-controller>carvel-secretgen-controller</a>. Use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f https://github.com/vmware-tanzu/carvel-secretgen-controller/releases/latest/download/release.yml
</span></span></code></pre></div><p>Execute following commands to add TAP package.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export TAP_NAMESPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tap-install&#34;</span>
</span></span><span style=display:flex><span>kubectl create ns <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># tanzu registry secret creation</span>
</span></span><span style=display:flex><span>tanzu secret registry add tap-registry <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --username <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_REGISTRY_USERNAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --password <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_REGISTRY_PASSWORD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --server <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_REGISTRY_HOSTNAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --export-to-all-namespaces --yes --namespace <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># tanzu repo add</span>
</span></span><span style=display:flex><span>tanzu package repository add tanzu-tap-repository <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --url registry.tanzu.vmware.com/tanzu-application-platform/tap-packages:1.1.0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --namespace <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tanzu package repository get tanzu-tap-repository --namespace <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># tap available package list</span>
</span></span><span style=display:flex><span>tanzu package available list --namespace <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h3 id=a-idtap-profile-build-astep-3-install-tanzu-application-platform-build-profile>Step 3: Install Tanzu Application Platform Build Profile</h3><p>Provide following user inputs to set environment variables into commands and execute them to install the build profile.</p><ul><li><code>TAP_REGISTRY_SERVER</code> - uri of registry server</li><li><code>TAP_REGISTRY_USER</code> - registry user</li><li><code>TAP_REGISTRY_PASSWORD</code> - registry password</li><li><code>INSTALL_REGISTRY_USERNAME</code>- tanzu net username</li><li><code>INSTALL_REGISTRY_PASSWORD</code> - tanzu net password</li></ul><p>For more information, see <a href=https://docs.vmware.com/en/VMware-Tanzu-Application-Platform/1.1/tap/GUID-multicluster-reference-tap-values-build-sample.html>Build Profile</a> in the Tanzu Application Platform product documentation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export TAP_NAMESPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tap-install&#34;</span>
</span></span><span style=display:flex><span>export TAP_REGISTRY_SERVER<span style=color:#f92672>=</span>&lt;registry server uri&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_USER<span style=color:#f92672>=</span>&lt;registry user&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;registry password&gt;
</span></span><span style=display:flex><span>export INSTALL_REGISTRY_USERNAME<span style=color:#f92672>=</span>&lt;tanzu username&gt;
</span></span><span style=display:flex><span>export INSTALL_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;tanzu password&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | tee tap-values-build.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>profile: build
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ceip_policy_disclosed: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>buildservice:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kp_default_repository: &#34;${TAP_REGISTRY_SERVER}/build-service&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kp_default_repository_username: &#34;${TAP_REGISTRY_USER}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kp_default_repository_password: &#34;${TAP_REGISTRY_PASSWORD}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  tanzunet_username: &#34;${INSTALL_REGISTRY_USERNAME}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  tanzunet_password: &#34;${INSTALL_REGISTRY_PASSWORD}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  descriptor_name: &#34;full&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enable_automatic_dependency_updates: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>supply_chain: basic
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ootb_supply_chain_basic:    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  registry:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server: &#34;${TAP_REGISTRY_SERVER}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    repository: &#34;supply-chain&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  gitops:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ssh_secret: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  cluster_builder: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  service_account: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>grype:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  targetImagePullSecret: &#34;tap-registry&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>image_policy_webhook:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  allow_unmatched_images: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tanzu package install tap -p tap.tanzu.vmware.com -v 1.1.0 --values-file tap-values-build.yaml -n <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>tanzu package installed get tap -n <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># check all build cluster package installed succesfully</span>
</span></span><span style=display:flex><span>tanzu package installed list -A
</span></span></code></pre></div><h3 id=a-idtap-dev-namespace-astep-4-configure-developer-namespaces-to-use-installed-packages>Step 4: Configure developer namespaces to use installed packages</h3><p>Execute the following commands to configure a developer namespace:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export TAP_DEV_NAMESPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>export TAP_REGISTRY_SERVER<span style=color:#f92672>=</span>&lt;registry server uri&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_USER<span style=color:#f92672>=</span>&lt;registry user&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;registry password&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tanzu secret registry add registry-credentials --server <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_REGISTRY_SERVER<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --username <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_REGISTRY_USER<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --password <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_REGISTRY_PASSWORD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --namespace <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_DEV_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl -n &#34;${TAP_DEV_NAMESPACE}&#34; apply -f -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Secret
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: tap-registry
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  annotations:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    secretgen.carvel.dev/image-pull-secret: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type: kubernetes.io/dockerconfigjson
</span></span></span><span style=display:flex><span><span style=color:#e6db74>data:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  .dockerconfigjson: e30K
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>secrets:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - name: registry-credentials
</span></span></span><span style=display:flex><span><span style=color:#e6db74>imagePullSecrets:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - name: registry-credentials
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - name: tap-registry
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: RoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: default-permit-deliverable
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: deliverable
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: RoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: default-permit-workload
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: workload
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=a-idtap-run-a-set-up-tanzu-application-platform-run-cluster>Set Up Tanzu Application Platform Run Cluster</h2><p>The Run Cluster utilizes the container image and Kubernetes resources created by the Build Cluster and runs them as defined in the Deliverable object for each application.</p><h3 id=step-1-install-tanzu-cluster-essentials-and-tanzu-cli>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</h3><p>Log in to your Kubernetes Run Cluster and perform steps outlined in <a href=#tanzu-essential>Install Tanzu Cluster Essentials and Tanzu CLI</a>.</p><h3 id=step-2-add-the-tanzu-application-platform-package-repository>Step 2: Add the Tanzu Application Platform Package Repository</h3><p>Perform the steps outlined in <a href=#tap-package-repo>Add the Tanzu Application Platform package repository</a>.</p><h3 id=a-idtap-profile-run-astep-3-install-tanzu-application-platform-run-profile>Step 3: Install Tanzu Application Platform Run Profile</h3><p>Provide the following user inputs to set environments variables into commands and execute them to install run profile</p><ul><li><code>TAP_REGISTRY_SERVER</code> - uri of the image registry</li><li><code>TAP_REGISTRY_USER</code> - registry user</li><li><code>TAP_REGISTRY_PASSWORD</code> - registry password</li><li><code>TAP_CNRS_DOMAIN</code> - cnrs app domain (could be sub domain of main domain like example - run.customer0.io)</li><li><code>TAP_ALV_DOMAIN</code> - app live view app domain</li></ul><p><strong>Note</strong> - Contour settings in tap-values-run.yaml must be modified if you are not using AWS.</p><p>For more information, see <a href=https://docs.vmware.com/en/VMware-Tanzu-Application-Platform/1.1/tap/GUID-multicluster-reference-tap-values-run-sample.html>Run Profile</a> in the Tanzu Application Platform product documentation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export TAP_NAMESPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tap-install&#34;</span>
</span></span><span style=display:flex><span>export TAP_REGISTRY_SERVER<span style=color:#f92672>=</span>&lt;registry uri&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_USER<span style=color:#f92672>=</span>&lt;registry user&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;registry password&gt;
</span></span><span style=display:flex><span>export TAP_CNRS_DOMAIN<span style=color:#f92672>=</span>&lt;cnrs domain&gt;
</span></span><span style=display:flex><span>export TAP_ALV_DOMAIN<span style=color:#f92672>=</span>&lt; app live view app domain&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | tee tap-values-run.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>profile: run
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ceip_policy_disclosed: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>supply_chain: basic
</span></span></span><span style=display:flex><span><span style=color:#e6db74>contour:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  infrastructure_provider: aws
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  envoy:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    service:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      aws:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        LBType: nlb
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cnrs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  domain_name: &#34;${tap_run_cnrs_domain}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>appliveview_connector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  backend:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sslDisabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    host: appliveview.$TAP_ALV_DOMAIN
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tanzu package install tap -p tap.tanzu.vmware.com -v 1.1.0 --values-file tap-values-run.yaml -n <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>tanzu package installed get tap -n <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># check all build cluster package installed succesfully</span>
</span></span><span style=display:flex><span>tanzu package installed list -A
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># check ingress external ip</span>
</span></span><span style=display:flex><span>kubectl get svc -n tanzu-system-ingress
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># pick external ip from service output  and configure DNS wild card(*) into your DNS server like aws route 53 etc.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># example - *.run.customer0.io ==&gt; &lt;ingress external ip/cname&gt;</span>
</span></span></code></pre></div><h3 id=step-4-configure-developer-namespaces-to-use-installed-packages>Step 4: Configure Developer Namespaces to Use Installed Packages</h3><p>Perform the steps outlined in <a href=#tap-dev-namespace>Configure developer namespaces to use installed packages</a></p><p>Execute steps 1-4 outlined in <a href=#tap-run>Set Up Tanzu Application Platform Run cluster</a> to build Dev/Test/QA/Prod clusters.</p><h2 id=a-idtap-ui-a-set-up-tanzu-application-platform-view-cluster>Set Up Tanzu Application Platform View Cluster</h2><p>The View cluster is designed to run the web applications for TAP; specifically Tanzu Learning Center, Tanzu Application Portal GUI, and Tanzu API Portal.</p><h3 id=step-1-install-tanzu-cluster-essentials-and-tanzu-cli-1>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</h3><p>Please ensure you login into your Kubernetes Run cluster and perform steps outlined in <a href=#tanzu-essential>Install Tanzu Cluster Essentials and Tanzu CLI</a>.</p><h3 id=step-2-add-the-tanzu-application-platform-package-repository-1>Step 2: Add the Tanzu Application Platform Package Repository</h3><p>Perform steps outlined in <a href=#tap-package-repo>Add the Tanzu Application Platform package repository</a></p><h3 id=a-idtap-profile-ui-astep-3-install-tanzu-application-platform-view-profile>Step 3: Install Tanzu Application Platform View Profile</h3><p>Provide following user inputs to set environments variables into commands and execute them to install view profile</p><ul><li><code>TAP_REGISTRY_SERVER</code> - uri of image registry</li><li><code>TAP_REGISTRY_USER</code> - registry user</li><li><code>TAP_REGISTRY_PASSWORD</code> - registry password</li><li><code>TAP_GITHUB_TOKEN</code> - GitHub personal access token</li><li><code>TAP_APP_DOMAIN</code> - app domain you want to use for tap-gui</li><li><code>TAP_GIT_CATALOG_URL</code> - git catalog url.<br>See this <a href=https://github.com/sendjainabhi/tap/blob/main/catalog-info.yaml>example</a></li><li><code>TAP_RUN_CLUSTER_NAME</code> - Run cluster name</li></ul><p>See <a href=https://docs.vmware.com/en/VMware-Tanzu-Application-Platform/1.1/tap/GUID-multicluster-reference-tap-values-view-sample.html>View Profile</a> for more details.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>export TAP_NAMESPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tap-install&#34;</span>
</span></span><span style=display:flex><span>export TAP_SERVICE_ACCOUNT_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | tee tap-gui-viewer-service-account-rbac.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: tap-gui
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: tap-gui
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: tap-gui-viewer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: tap-gui-read-k8s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: tap-gui
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: tap-gui-viewer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: k8s-reader
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: k8s-reader
</span></span></span><span style=display:flex><span><span style=color:#e6db74>rules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources: [&#39;pods&#39;, &#39;services&#39;, &#39;configmaps&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;apps&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources: [&#39;deployments&#39;, &#39;replicasets&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;autoscaling&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources: [&#39;horizontalpodautoscalers&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;networking.k8s.io&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources: [&#39;ingresses&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;networking.internal.knative.dev&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources: [&#39;serverlessservices&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [ &#39;autoscaling.internal.knative.dev&#39; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources: [ &#39;podautoscalers&#39; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [ &#39;get&#39;, &#39;watch&#39;, &#39;list&#39; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;serving.knative.dev&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - configurations
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - revisions
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - routes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - services
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;carto.run&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clusterconfigtemplates
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clusterdeliveries
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clusterdeploymenttemplates
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clusterimagetemplates
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clusterruntemplates
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clustersourcetemplates
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clustersupplychains
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - clustertemplates
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - deliverables
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - runnables
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - workloads
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;source.toolkit.fluxcd.io&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - gitrepositories
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;source.apps.tanzu.vmware.com&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - imagerepositories
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;conventions.apps.tanzu.vmware.com&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - podintents
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;kpack.io&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - images
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - builds
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;scanning.apps.tanzu.vmware.com&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - sourcescans
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - imagescans
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - scanpolicies
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;tekton.dev&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - taskruns
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - pipelineruns
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- apiGroups: [&#39;kappctrl.k14s.io&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - apps
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl create -f tap-gui-viewer-service-account-rbac.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CLUSTER_URL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl config view --minify -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.clusters[0].cluster.server}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CLUSTER_TOKEN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl -n tap-gui get secret <span style=color:#66d9ef>$(</span>kubectl -n tap-gui get sa tap-gui-viewer -o<span style=color:#f92672>=</span>json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>| jq -r <span style=color:#e6db74>&#39;.secrets[0].name&#39;</span><span style=color:#66d9ef>)</span> -o<span style=color:#f92672>=</span>json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>| jq -r <span style=color:#e6db74>&#39;.data[&#34;token&#34;]&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>| base64 --decode<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>See <a href=https://backstage.io/docs/features/kubernetes/configuration#label-selector-query-annotation>Backstage</a> documentation for multi-cluster/multi-tenant details.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># set the following variables</span>
</span></span><span style=display:flex><span>export TAP_NAMESPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tap-install&#34;</span>
</span></span><span style=display:flex><span>export TAP_REGISTRY_SERVER<span style=color:#f92672>=</span>&lt;registry server uri&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_USER<span style=color:#f92672>=</span>&lt;registry_user&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;registry_password&gt;
</span></span><span style=display:flex><span>export TAP_GITHUB_TOKEN<span style=color:#f92672>=</span>&lt;github_token&gt;
</span></span><span style=display:flex><span>export TAP_VIEW_APP_DOMAIN<span style=color:#f92672>=</span>&lt;sub domain of view cluster&gt;
</span></span><span style=display:flex><span>export TAP_GIT_CATALOG_URL<span style=color:#f92672>=</span>&lt;git_catalog_url&gt;
</span></span><span style=display:flex><span>export TAP_RUN_CLUSTER_NAME<span style=color:#f92672>=</span>&lt;run cluster name&gt;
</span></span><span style=display:flex><span>export TAP_ALV_DOMAIN<span style=color:#f92672>=</span>&lt; app live view app domain&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | tee tap-values-view.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>profile: view
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ceip_policy_disclosed: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>contour:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  envoy:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    service:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      type: LoadBalancer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>learningcenter:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ingressDomain: &#34;learning.${TAP_VIEW_APP_DOMAIN}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ingressClass: contour
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tap_gui:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  service_type: ClusterIP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ingressEnabled: &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ingressDomain: &#34;${TAP_VIEW_APP_DOMAIN}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  app_config:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      baseUrl: &#34;http://tap-gui.${TAP_VIEW_APP_DOMAIN}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    catalog:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      locations:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - type: url
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          target: ${TAP_GIT_CATALOG_URL}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    backend:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        baseUrl: &#34;http://tap-gui.${TAP_VIEW_APP_DOMAIN}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cors:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          origin: &#34;http://tap-gui.${TAP_VIEW_APP_DOMAIN}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    kubernetes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      serviceLocatorMethod:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        type: &#34;multiTenant&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      clusterLocatorMethods:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - type: &#34;config&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          clusters:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - url: ${CLUSTER_URL}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              name: ${TAP_RUN_CLUSTER_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              authProvider: &#34;serviceAccount&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              skipTLSVerify: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              skipMetricsLookup: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              serviceAccountToken: &#34;${CLUSTER_TOKEN}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata_store:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  app_service_type: LoadBalancer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>appliveview:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ingressEnabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ingressDomain: &#34;${TAP_ALV_DOMAIN}&#34; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tanzu package install tap -p tap.tanzu.vmware.com -v 1.1.0 --values-file tap-values-view.yaml -n <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>tanzu package installed get tap -n <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ensure all build cluster packages are installed succesfully</span>
</span></span><span style=display:flex><span>tanzu package installed list -A
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get svc -n tanzu-system-ingress
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># pick an external ip from service output and configure DNS wildcard records</span>
</span></span><span style=display:flex><span><span style=color:#75715e># example - *.ui.customer0.io ==&gt; &lt;ingress external ip/cname&gt;</span>
</span></span></code></pre></div><h3 id=step-4-set-up-developer-namespaces-to-use-installed-packages>Step 4: Set Up Developer Namespaces to Use Installed Packages</h3><p>Perform the steps outlined in <a href=#tap-dev-namespace>Configure developer namespaces to use installed packages</a></p><h3 id=deploy-sample-application>Deploy Sample Application</h3><p>See the steps to deploy and test the <a href=#tap-sample-app>sample application</a>.</p><p>For more information, also see <a href=https://docs.vmware.com/en/Tanzu-Application-Platform/1.1/tap/GUID-getting-started.html>Getting started with the Tanzu Application Platform</a>.</p><h2 id=a-idtap-full-a-set-up-tanzu-application-platform-iterate-cluster>Set Up Tanzu Application Platform Iterate Cluster</h2><p>The Iterate Cluster is for &ldquo;inner loop&rdquo; development iteration where developers are connecting via their IDE to rapidly iterate on new software features</p><h3 id=step-1-install-tanzu-cluster-essentials-and-tanzu-cli-2>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</h3><p>Log in to the Kubernetes View Cluster and perform steps outlined in <a href=#tanzu-essential>Install Tanzu Cluster Essentials and Tanzu CLI</a>.</p><h3 id=step-2-add-the-tanzu-application-platform-package-repository-2>Step 2: Add the Tanzu Application Platform Package Repository</h3><p>Perform steps outlined in <a href=#tap-package-repo>Add the Tanzu Application Platform package repository</a></p><h3 id=a-idtap-profile-full-astep-3-install-tanzu-application-platform-iterate-profile>Step 3: Install Tanzu Application Platform Iterate Profile</h3><p>Provide the following user inputs to set environment variables into commands and execute them to install Iterate profile</p><ul><li><code>TAP_REGISTRY_SERVER</code> - uri of image registry</li><li><code>TAP_REGISTRY_USER</code> - registry user</li><li><code>TAP_REGISTRY_PASSWORD</code> - registry user</li><li><code>TAP_GITHUB_TOKEN</code> - GitHub personal access token</li><li><code>TAP_APP_DOMAIN</code> - app domain you want to use for tap-gui</li><li><code>INSTALL_REGISTRY_USERNAME</code>- tanzu net username</li><li><code>INSTALL_REGISTRY_PASSWORD</code> - tanzu net password</li><li><code>TAP_ITERATE_CNRS_DOMAIN</code> - tap iterate cluster cnrs domain</li></ul><p>For more information, see <a href=https://docs.vmware.com/en/Tanzu-Application-Platform/1.1/tap/GUID-install.html#full-profile>Full Profile</a> in the Tanzu Application Platform product documentation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># set following variables</span>
</span></span><span style=display:flex><span>export TAP_NAMESPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tap-install&#34;</span>
</span></span><span style=display:flex><span>export TAP_REGISTRY_SERVER<span style=color:#f92672>=</span>&lt;registry server uri&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_USER<span style=color:#f92672>=</span>&lt;registry user&gt;
</span></span><span style=display:flex><span>export TAP_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;registry password&gt;
</span></span><span style=display:flex><span>export TAP_ITERATE_CNRS_DOMAIN<span style=color:#f92672>=</span>&lt;tap iterate cnrs  domain&gt;
</span></span><span style=display:flex><span>export INSTALL_REGISTRY_USERNAME<span style=color:#f92672>=</span>&lt;tanzu net username&gt;
</span></span><span style=display:flex><span>export INSTALL_REGISTRY_PASSWORD<span style=color:#f92672>=</span>&lt;tanzu net  password&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | tee tap-values-iterate.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>profile: iterate
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ceip_policy_disclosed: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>buildservice:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kp_default_repository: &#34;${TAP_RE</span>GISTRY_SERVER<span style=color:#f92672>}</span>/build-service<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kp_default_repository_username: &#34;</span><span style=color:#e6db74>${</span>TAP_REGISTRY_USER<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kp_default_repository_password: &#34;</span><span style=color:#e6db74>${</span>TAP_REGISTRY_PASSWORD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  tanzunet_username: &#34;</span><span style=color:#e6db74>${</span>INSTALL_REGISTRY_USERNAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  tanzunet_password: &#34;</span><span style=color:#e6db74>${</span>INSTALL_REGISTRY_PASSWORD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  descriptor_name: &#34;</span>full<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enable_automatic_dependency_updates: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>supply_chain: basic
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ootb_supply_chain_basic:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  registry:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server: &#34;</span><span style=color:#e6db74>${</span>TAP_REGISTRY_SERVER<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    repository: &#34;</span>supply-chain<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  gitops:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ssh_secret: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata_store:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  app_service_type: LoadBalancer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>image_policy_webhook:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  allow_unmatched_tags: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>contour:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  envoy:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    service:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      type: LoadBalancer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cnrs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  domain_name: &#34;</span><span style=color:#e6db74>${</span>TAP_ITERATE_CNRS_DOMAIN<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tanzu package install tap -p tap.tanzu.vmware.com -v 1.1.0 --values-file tap-values-iterate.yaml -n &#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tanzu package installed get tap -n &#34;</span><span style=color:#e6db74>${</span>TAP_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#check all build cluster package installed succesfully
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tanzu package installed list -A
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kubectl get svc -n tanzu-system-ingress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#pick external ip from output and configure DNS wild card into your DNS server like aws route 53 etc.
</span></span></span></code></pre></div><h3 id=step-4-set-up-developer-namespaces-to-use-installed-packages-1>Step 4: Set Up Developer Namespaces to Use Installed Packages</h3><p>Perform the steps outlined in <a href=#tap-dev-namespace>Set up developer namespaces to use installed packages</a></p><h2 id=a-idtap-sample-app-deploy-sample-application>Deploy Sample Application</h2><p>Execute following command to see the demo of sample app deployment into Tanzu Application Platform.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># login to kubernetes workload build cluster</span>
</span></span><span style=display:flex><span>kubectl config get-contexts
</span></span><span style=display:flex><span>kubectl config use-context &lt;cluster config name&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export TAP_APP_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tap-demo&#34;</span>
</span></span><span style=display:flex><span>export TAP_APP_GIT_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://github.com/sample-accelerators/spring-petclinic&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tanzu apps workload delete --all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tanzu apps workload list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># generate work load yml file</span>
</span></span><span style=display:flex><span>tanzu apps workload create <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --git-repo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_GIT_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --git-branch main --type web --label app.kubernetes.io/part-of<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --yes --dry-run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create work load for app</span>
</span></span><span style=display:flex><span>tanzu apps workload create <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--git-repo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_GIT_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--git-branch main <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--git-tag tap-1.1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--type web <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--label app.kubernetes.io/part-of<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--label apps.tanzu.vmware.com/has-tests<span style=color:#f92672>=</span>true <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--yes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># app deployment logs#sam</span>
</span></span><span style=display:flex><span>tanzu apps workload tail <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> --since 10m --timestamp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># get app workload list</span>
</span></span><span style=display:flex><span>tanzu apps workload list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># get app details</span>
</span></span><span style=display:flex><span>tanzu apps workload get <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># saved deliverables yaml configuration into local directory. check below sample file below</span>
</span></span><span style=display:flex><span>kubectl get deliverables <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -o yaml |  yq <span style=color:#e6db74>&#39;del(.status)&#39;</span>  | yq <span style=color:#e6db74>&#39;del(.metadata.ownerReferences)&#39;</span> | yq <span style=color:#e6db74>&#39;del(.metadata.resourceVersion)&#39;</span> | yq <span style=color:#e6db74>&#39;del(.metadata.uid)&#39;</span> &gt;  <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>-delivery.yaml&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sample deliverable</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##################################################</span>
</span></span><span style=display:flex><span>apiVersion: carto.run/v1alpha1
</span></span><span style=display:flex><span>kind: Deliverable
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: <span style=color:#e6db74>&#34;2022-02-01T20:19:19Z&#34;</span>
</span></span><span style=display:flex><span>  generation: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app.kubernetes.io/component: deliverable
</span></span><span style=display:flex><span>    app.kubernetes.io/part-of: tap-demo
</span></span><span style=display:flex><span>    app.tanzu.vmware.com/deliverable-type: web
</span></span><span style=display:flex><span>    carto.run/cluster-supply-chain-name: source-to-url
</span></span><span style=display:flex><span>    carto.run/cluster-template-name: deliverable-template
</span></span><span style=display:flex><span>    carto.run/resource-name: deliverable
</span></span><span style=display:flex><span>    carto.run/template-kind: ClusterTemplate
</span></span><span style=display:flex><span>    carto.run/workload-name: tap-demo
</span></span><span style=display:flex><span>    carto.run/workload-namespace: default
</span></span><span style=display:flex><span>  name: tap-demo
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  source:
</span></span><span style=display:flex><span>    image: tapdemo2.azurecr.io/supply-chain/tap-demo-default-bundle:83c468d4-4fd0-4f3b-9e57-9cdfe57e730a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##################################################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e># login to kubernetes workload run cluster</span>
</span></span><span style=display:flex><span>kubectl config get-contexts
</span></span><span style=display:flex><span>kubectl config use-context &lt;cluster config name&gt;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># apply app-delivery into run cluster</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl apply -f app-delivery.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># check app status</span>
</span></span><span style=display:flex><span>kubectl get deliverables <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>TAP_APP_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># get app url</span>
</span></span><span style=display:flex><span>kubectl get ksvc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># copy app url and paste into browser to see the sample app</span>
</span></span></code></pre></div><h3 id=register-entity-into-tap-gui>Register Entity into tap-gui</h3><ul><li><p>Open tap-gui URL and click the <strong>Register Entity</strong> button and provide the <code>catalog-info.yaml</code> file URL of your app. See <a href=https://github.com/sample-accelerators/tanzu-java-web-app/blob/main/catalog/catalog-info.yaml>Example</a>.</p></li><li><p>Make sure you have set up <code>app.kubernetes.io/part-of=app name</code> correctly into your app catalog-info.yaml. and it should match with your app name.
<strong>Example: <code>'backstage.io/kubernetes-label-selector': 'app.kubernetes.io/part-of=tap-demo2'</code></strong></p></li></ul><h3 id=troubleshooting-tanzu-application-platform>Troubleshooting Tanzu Application Platform</h3><p>In the event of failure, use the following command to obtain failure details:
<code>kubectl get packageinstall/&lt;package> -n tap-install -o yaml</code>.</p><p>See <a href=https://docs.vmware.com/en/Tanzu-Application-Platform/1.1/tap/GUID-troubleshooting.html>Troubleshooting Tanzu Application Platform Tips</a> for additional details.</p><h3 id=service-bindings-for-kubernetes>Service Bindings for Kubernetes</h3><p>See <a href=https://docs.vmware.com/en/Tanzu-Application-Platform/1.1/tap/GUID-service-bindings-about.html>Service Bindings for Kubernetes</a> for additional details.</p><h3 id=tanzu-application-platform-gui-auth-provider>Tanzu Application Platform GUI Auth Provider</h3><p>See <a href=https://docs.vmware.com/en/Tanzu-Application-Platform/1.1/tap/GUID-tap-gui-auth.html>Setting up a Tanzu Application Platform GUI authentication provider</a> for additional details.</p></div></div><div class="loader-container-toc col-lg-2 w-100" style=display:none><span class=spinner></span></div><div class="rhs-right-container d-none d-lg-block col-lg-2"><div class=rhs-right-panel><div class="rhs-right-panel-header d-flex justify-content-between"><div class=rhs-right-panel-title>In this article</div></div><div id=right-toc-div-id class="onpage-toc-container d-flex flex-column"><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#overview-of-the-deployment-steps>Overview of the Deployment Steps</a></li><li><a href=#a-idtap-build-aset-up-tanzu-application-platform-build-cluster>Set Up Tanzu Application Platform Build Cluster</a><ul><li><a href=#a-idtanzu-essential-a-step-1-install-tanzu-cluster-essentials-and-tanzu-cli>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</a></li><li><a href=#a-idtap-package-repo-astep-2-add-the-tanzu-application-platform-package-repository>Step 2: Add the Tanzu Application Platform Package Repository</a></li><li><a href=#a-idtap-profile-build-astep-3-install-tanzu-application-platform-build-profile>Step 3: Install Tanzu Application Platform Build Profile</a></li><li><a href=#a-idtap-dev-namespace-astep-4-configure-developer-namespaces-to-use-installed-packages>Step 4: Configure developer namespaces to use installed packages</a></li></ul></li><li><a href=#a-idtap-run-a-set-up-tanzu-application-platform-run-cluster>Set Up Tanzu Application Platform Run Cluster</a><ul><li><a href=#step-1-install-tanzu-cluster-essentials-and-tanzu-cli>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</a></li><li><a href=#step-2-add-the-tanzu-application-platform-package-repository>Step 2: Add the Tanzu Application Platform Package Repository</a></li><li><a href=#a-idtap-profile-run-astep-3-install-tanzu-application-platform-run-profile>Step 3: Install Tanzu Application Platform Run Profile</a></li><li><a href=#step-4-configure-developer-namespaces-to-use-installed-packages>Step 4: Configure Developer Namespaces to Use Installed Packages</a></li></ul></li><li><a href=#a-idtap-ui-a-set-up-tanzu-application-platform-view-cluster>Set Up Tanzu Application Platform View Cluster</a><ul><li><a href=#step-1-install-tanzu-cluster-essentials-and-tanzu-cli-1>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</a></li><li><a href=#step-2-add-the-tanzu-application-platform-package-repository-1>Step 2: Add the Tanzu Application Platform Package Repository</a></li><li><a href=#a-idtap-profile-ui-astep-3-install-tanzu-application-platform-view-profile>Step 3: Install Tanzu Application Platform View Profile</a></li><li><a href=#step-4-set-up-developer-namespaces-to-use-installed-packages>Step 4: Set Up Developer Namespaces to Use Installed Packages</a></li><li><a href=#deploy-sample-application>Deploy Sample Application</a></li></ul></li><li><a href=#a-idtap-full-a-set-up-tanzu-application-platform-iterate-cluster>Set Up Tanzu Application Platform Iterate Cluster</a><ul><li><a href=#step-1-install-tanzu-cluster-essentials-and-tanzu-cli-2>Step 1: Install Tanzu Cluster Essentials and Tanzu CLI</a></li><li><a href=#step-2-add-the-tanzu-application-platform-package-repository-2>Step 2: Add the Tanzu Application Platform Package Repository</a></li><li><a href=#a-idtap-profile-full-astep-3-install-tanzu-application-platform-iterate-profile>Step 3: Install Tanzu Application Platform Iterate Profile</a></li><li><a href=#step-4-set-up-developer-namespaces-to-use-installed-packages-1>Step 4: Set Up Developer Namespaces to Use Installed Packages</a></li></ul></li><li><a href=#a-idtap-sample-app-deploy-sample-application>Deploy Sample Application</a><ul><li><a href=#register-entity-into-tap-gui>Register Entity into tap-gui</a></li><li><a href=#troubleshooting-tanzu-application-platform>Troubleshooting Tanzu Application Platform</a></li><li><a href=#service-bindings-for-kubernetes>Service Bindings for Kubernetes</a></li><li><a href=#tanzu-application-platform-gui-auth-provider>Tanzu Application Platform GUI Auth Provider</a></li></ul></li></ul></nav></div></div></div></section></div><footer class=tech-pub-footer><div id=page-footer><section class="footer-component footer-container"><div class=personalization_div_1 style=min-height:1px></div><div class=personalization_div_2 style=min-height:1px></div><div class=container><div class=content><div class=row><div class="col-lg-12 col-md-12"><footer class=footer><div class=row><div class="col-lg-2 col-md-12 mb-40 mt-3"><a class=footer-vmware-logo href=https://www-lt.vmware.com/ name="nav_footer : VMware Logo"><picture class=float-lg-left><source media=(max-width:800px) srcset=https://www-lt.vmware.com/content/dam/digitalmarketing/vmware/vm-logo-big.png.imgo.jpeg><img loading=lazy class=vmware-logo src=/img/vm-logo-big.png alt=VMware title=VMware></picture></a></div></div></footer></div></div></div></div></section></div></footer><script src=/js/pageStore.js></script>
<script src=/js/main.js></script></body></html>